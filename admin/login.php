<?php $_POST["errormessagetype"] = "html" ?><?php require_once("../includes/settings.php") ?><?php require_once("../includes/constants.php") ?><?php require("../includes/errormessages.php") ?><?php require_once("../includes/dbfunctions.php") ?><?php require_once("../includes/generalfunctions.php") ?><?php require_once("../includes/authentication.php") ?><?phpfunction userAuthenticated($connection, $email){	global $errorstr;		$password = $_POST["password"];		if (empty($email) || empty($password))	{		$errorstr = "You must complete all fields to login.";		return false;	}		if ($email != mysql_real_escape_string($email))	{		$errorstr = "That email address is not valid.";		return false;	}		$passwordhash = mysql_real_escape_string(md5(trim($password)));		$query = "SELECT COUNT(*) FROM admins WHERE email='{$email}'";	$result = mysql_query($query, $connection);	if (!$result)		die($_POST["preinvalidquery"] . mysql_error() . $_POST["postinvalidquery"]);			$row = mysql_fetch_row($result);	$numadmins = $row[0];		//Check if no admins are found	if ($numadmins == 0)	{		$errorstr = "That email address is not registered.";		return false;	}	//Admin is found	else	{						$query = "SELECT COUNT(*) FROM admins WHERE email='{$email}' AND password='{$passwordhash}'";		$result = mysql_query($query, $connection);		if (!$result)			die($_POST["preinvalidquery"] . mysql_error() . $_POST["postinvalidquery"]);				$row = mysql_fetch_row($result);		$numadminsmatchingpw = $row[0];				//Admin is found, but password is incorrect		if ($numadminsmatchingpw == 0)		{			$errorstr = "The password you entered is not valid.";			return false;		}	}	return true;}function login($connection, $email){	$adminid = getAdminID($connection, $email);		$_SESSION["adminid"] = $adminid;	$_SESSION["ip"] = $_SERVER["REMOTE_ADDR"];	$_SESSION["accessstring"] = "";}function administrate(){	header("Location: ../admin/index.php");	exit;}?><?php admin_session() ?><?phpif (isset($_POST["email"]) && !adminLoggedIn()){	openConnection();	$htmlerror = "";	$email = $_POST["email"];	$email = htmlspecialchars(strtolower($email), ENT_QUOTES);	if (userAuthenticated($connection, $email))	{		login($connection, $email);		administrate();	}	else	{		$htmlerror .= "<p class=\"error\">Error: ";		$htmlerror .= $errorstr;		$htmlerror .= "</p>";	}	mysql_close($connection);}?><?php require_once("../includes/adminheader.php") ?><div id="navigation"><h3>Administrator Login</h3><?php require_once("../includes/adminnavbar.php") ?></div><?phpif (isset($_POST["email"]) && !adminLoggedIn()){?><div id="topnotice"><?php print $htmlerror ?></div><?php}?><div id="main"><?phpif (!adminLoggedIn())	print "<p>\nIf you are a registered administrator, enter your administrator email and password below. Please be aware that passwords are case sensitive.\n</p>";if (!adminLoggedIn()){	if (isset($_POST["email"]))		$email = htmlspecialchars($_POST["email"], ENT_QUOTES);	else		$email = "";?><form action="../admin/login.php" method="post"><div id="logininput"><p><span class="columnleft">Email:</span><span class="columnright"><input name="email" type="text" maxlength="60" value="<?php print $email ?>" /></span></p><p><span class="columnleft">Password:</span><span class="columnright"><input name="password" type="password" maxlength="30" /></span></p></div><p><input name="submit" type="submit" value="Login" /><input name="reset" type="button" value="Reset" onclick="window.location.href = '../admin/login.php'" /></p></form><?php}else	print "\n<p>\nYou are currently <span class=\"important\">logged in</span>.\n</p>\n";?><p>For questions regarding logins and passwords, contact the <a href="mailto:<?php print $webmaster ?>">webmaster</a>.</p></div><?php require_once("../includes/footer.php") ?>