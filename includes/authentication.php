<?php require_once("../includes/settings.php") ?><?php require_once("../includes/dbfunctions.php") ?><?php require_once("../includes/generalfunctions.php") ?><?phpfunction user_session(){	global $usersessid;		if (!isset($usersessid))	{		$usersessid = session_name("usersession");		session_start();	}}function admin_session(){	global $adminsessid;		if (!isset($adminsessid))	{		$adminsessid = session_name("adminsession");		session_start();	}}function user_session_erase(){	user_session(); //Specify which session I am erasing	$_SESSION = array();	session_destroy();}function admin_session_erase(){	admin_session(); //Specify which session I am erasing	$_SESSION = array();	session_destroy();}function user_session_authenticate(){	if (!isset($_SESSION["userid"]))	{		$_SESSION["message"] = "You are not authorized to access the URL {$_SERVER['REQUEST_URI']}.";		header("Location: ../user/logout.php");		exit;	}	else if (!isset($_SESSION["ip"])) //|| ($_SESSION["ip"] != $_SERVER["REMOTE_ADDR"])) <-- This seems to interfere with AOL users	{		$_SESSION["message"] = "You are not authorized to access the URL {$_SERVER['REQUEST_URI']} from the address {$_SERVER['REMOTE_ADDR']}.";		header("Location: ../user/logout.php");		exit;	}		//Added for initializing table names upon successful authentication		initializeTableNamesInSession();}function admin_session_authenticate(){	if (!isset($_SESSION["adminid"]))	{		$_SESSION["message"] = "You are not authorized to access the URL {$_SERVER['REQUEST_URI']}.";		header("Location: ../admin/logout.php");		exit;	}	else if (!isset($_SESSION["ip"]) || ($_SESSION["ip"] != $_SERVER["REMOTE_ADDR"]))	{		$_SESSION["message"] = "You are not authorized to access the URL {$_SERVER['REQUEST_URI']} from the address {$_SERVER['REMOTE_ADDR']}.";		header("Location: ../admin/logout.php");		exit;	}}function user_session_authenticate_accessstring($accessstring){	if (!isset($_SESSION["userid"]))	{		$_SESSION["message"] = "You are not authorized to access the URL {$_SERVER['REQUEST_URI']}.";		header("Location: ../user/logout.php");		exit;	}	else if (!isset($_SESSION["ip"])) //|| ($_SESSION["ip"] != $_SERVER["REMOTE_ADDR"])) <-- This seems to interfere with AOL users	{		$_SESSION["message"] = "You are not authorized to access the URL {$_SERVER['REQUEST_URI']} from the address {$_SERVER['REMOTE_ADDR']}.";		header("Location: ../user/logout.php");		exit;	}		if ($_SESSION["accessstring"] != $accessstring)	{		$_SESSION["message"] = "You have tried to improperly access the URL {$_SERVER['REQUEST_URI']}.";		$_SESSION["accessstring"] = "unauthorized";		header("Location: ../user/unauthorized.php");		exit;	}		$_SESSION["accessstring"] = ""; //The accessstring is for one time only}function userLoggedIn(){		global $connection;		if (!isset($_SESSION["userid"]) || (!isset($_SESSION["ip"]))) //|| ($_SESSION["ip"] != $_SERVER["REMOTE_ADDR"]))) <-- This seems to interfere with AOL users		return false;			return true;}function adminLoggedIn(){	$loggedin = true;		if (!isset($_SESSION["adminid"]) || (!isset($_SESSION["ip"]) || ($_SESSION["ip"] != $_SERVER["REMOTE_ADDR"])))		$loggedin = false;			return $loggedin;}function createSessionHash($connection){		$sessionhash = mysql_real_escape_string(md5(generateRandomString(32)));	return $sessionhash;}function generateRandomString($length){	$chars = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPRQSTUVWXYZ0123456789";	$string = "";	$clen = strlen($chars) - 1;		while (strlen($string) < $length)	{		$string .= $chars[mt_rand(0, $clen)];	}		return $string;}?>